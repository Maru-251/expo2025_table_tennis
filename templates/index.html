<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ä¸‡åšã¾ã¨ã‚ã‚µã‚¤ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <!-- Bootstrap 5  +  Bootstrap Iconsï¼ˆè¿½åŠ ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã«ï¼‰-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>

<body class="bg-light">
<div class="title-band container-fluid text-center px-0 position-relative">         <!-- èƒŒæ™¯ç”»åƒã®è¨­å®šã¯ã“ã®ã¾ã¾ -->
  <h1 class="my-0 mx-5">ä¸‡åš&å¤§é˜ªæ—…è¡Œãƒ¡ãƒ¢</h1>

  <!-- â˜… è¿½åŠ ï¼šãƒ˜ãƒƒãƒ€å³ç«¯ãƒªãƒ³ã‚¯ -->
    <nav class="header-links d-flex flex-column flex-md-row gap-2 justify-content-center justify-content-md-end">
    <a href="/tickets" class="btn btn-outline-light btn-md me-2">ãƒã‚±ãƒƒãƒˆ</a>
    <a href="/access"  class="btn btn-outline-light btn-md me-2">ã‚¢ã‚¯ã‚»ã‚¹</a>
    <a href="/public" class="btn btn-outline-light btn-md">ã¿ã‚“ãªã®ãƒªã‚¹ãƒˆ</a>
    </nav>
    
  <p class="welcome-msg text-white position-absolute start-0 bottom-0 ms-3 mb-2">
    ã‚ˆã†ã“ãã€{{ username }}ã•ã‚“ï¼
  </p>
</div>


<div class="container py-5">            <!-- w-75 ã‚’å¤–ã—ãƒ•ãƒ«å¹…å¯„ã‚Šã« -->
  <div class="row g-4 align-items-start">

    <!-- â”€â”€â”€â”€â”€ å·¦ã‚«ãƒ©ãƒ  â”€â”€â”€â”€â”€ -->
    <div class="col-md-6 col-lg-6">

      <!-- åŸºæœ¬æƒ…å ± -->
      <div class="mb-3">
        <p class="fs-5"><i class="bi bi-calendar-month me-1"></i>æ—¥ç¨‹: <strong>{{ expo_info.open_day if expo_info else '2025/8/23, 8/25' }}</strong></p>
        <p class="fs-5"><i class="bi bi-map me-1"></i>ä¼šå ´: <strong>{{ expo_info.venue if expo_info else '' }}</strong></p>
      </div>

      <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ & DL ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå‰å›å®Ÿè£…ãã®ã¾ã¾ï¼‰ -->
      <div class="mb-4">
        <div class="position-relative d-inline-block">
          <a href="/static/expo_map.jpeg"
             download="expo_map.jpeg"
             class="download-icon position-absolute top-0 end-0 m-2"
             onclick="event.stopPropagation()"
             data-bs-toggle="tooltip" data-bs-placement="left"
             data-bs-title="ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
            <i class="bi bi-download"></i>
          </a>

        <img id="previewImage" src="/static/expo_map.jpeg"
             class="img-fluid rounded shadow-lg transition w-100"
             style="cursor:pointer;">
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€ å³ã‚«ãƒ©ãƒ  â”€â”€â”€â”€â”€ -->
    <div class="col-md-6 col-lg-6">

      <!-- è¦‹å‡ºã—ï¼‹è¿½åŠ ãƒœã‚¿ãƒ³ -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-muted mb-0 fs-3">è¡ŒããŸã„ã¨ã“ã‚ãƒªã‚¹ãƒˆ</h2>
        <button class="btn btn-outline-secondary" id="addBtn">
        <i class="bi bi-plus-lg me-1"></i> è¿½åŠ 
        </button>   
      </div>
        
      <!-- â˜… ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ -->
      <div class="btn-group btn-group-sm mb-3 w-100" id="filterGroup" role="group">
        <button type="button" class="btn btn-outline-secondary active" data-cat="all">ã™ã¹ã¦</button>
        <button type="button" class="btn btn-outline-secondary" data-cat="é£Ÿäº‹">
          <i class="bi bi-cup-hot me-1"></i>é£Ÿäº‹
        </button>
        <button type="button" class="btn btn-outline-secondary" data-cat="è¦³å…‰åœ°">
          <i class="bi bi-suitcase me-1"></i>è¦³å…‰åœ°</button>
        <button type="button" class="btn btn-outline-secondary" data-cat="ãƒ‘ãƒ“ãƒªã‚ªãƒ³">
          <i class="bi bi-bank me-1"></i>ãƒ‘ãƒ“ãƒªã‚ªãƒ³
        </button>
        <button type="button" class="btn btn-outline-secondary" data-cat="ãã®ä»–">ãã®ä»–</button>
      </div>

      <!-- ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«(è¡ŒããŸã„ã¨ã“ã‚ãƒªã‚¹ãƒˆ) -->
        <div class="table-responsive">        <!-- â˜… è¿½åŠ  -->
        <table class="table table-striped align-middle shadow-sm rounded-3 overflow-hidden mb-5" id="noteTable">
            <thead class="table-light">
            <tr>
                <th style="width:30px;" class="text-center"></th>
                <th style="width:80px;">ã‚¿ã‚¤ãƒˆãƒ«</th>
                <th style="width:110px;">å†…å®¹</th>
                <th style="width:110px;">è¨˜å…¥è€…</th>
                <th style="width:100px;">æ“ä½œ</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
        </div>

      <!-- Tips -->
      <h3 class="text-muted mt-10">Tips</h3>
      <ul>
        <li><a href="https://more.hpplus.jp/morejapan/news/118051/7/">ãŠã™ã™ã‚ã®å›ã‚Šæ–¹</a></li>
        <li><a href="https://www.expo2025.or.jp/news/daily/">ä»Šé€±ã®ä¸‡åšï¼ˆå…¬å¼ã‚µã‚¤ãƒˆï¼‰</a></li>
        <li>
            <tr>ãŠã™ã™ã‚ã‚¢ãƒ—ãƒªï¼ˆå…¬å¼ï¼‰:</tr>
            <a href="https://play.google.com/store/apps/details?id=com.nttus.EXPO2025PersonalAgent&hl=en&pli=1"> Google store</a>
            <tr>  </tr>
            <a href="https://apps.apple.com/jp/app/expo2025-personal-agent-ai%E3%83%8A%E3%83%93/id6621210768"> App store</a>
        </li>
        <li><a href="https://ameblo.jp/taiwan-momo/entry-12902398202.html">æŒã¡ç‰©ãƒ»äº‹å‰æº–å‚™</a></li> 
        <li><a href="https://expo2025.fun/%e3%83%91%e3%83%93%e3%83%aa%e3%82%aa%e3%83%b3%e5%be%85%e3%81%a1%e6%99%82%e9%96%93/">ãƒ‘ãƒ“ãƒªã‚ªãƒ³å¾…ã¡æ™‚é–“</a></li> 
        <li><a href="https://www.expo2025.or.jp/future-index/digital/wireless/">Wifiè¨­å®š</a></li> 
      </ul>
    </div>
  </div>

  <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¤‰æ›´ãªã—ï¼‰ -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark text-white">
        <div class="modal-header border-0">
            <h5 class="modal-title" id="imageModalLabel"></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="é–‰ã˜ã‚‹"></button>
        </div>
        <div class="modal-body text-center">
            <div style="display:inline-block; overflow:hidden;">
            <img id="modalImage" src="" alt="æ‹¡å¤§ç”»åƒ" class="img-fluid rounded">
            </div>
        </div>
        </div>
    </div>
    </div>

  <!-- â˜… è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="addForm">
          <div class="modal-header">
            <h5 class="modal-title" id="addModalLabel">ãƒ¡ãƒ¢ã‚’è¿½åŠ </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="addCategory" class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
              <select id="addCategory" class="form-select" required>
                <option value="é£Ÿäº‹">é£Ÿäº‹</option>
                <option value="è¦³å…‰åœ°">è¦³å…‰åœ°</option>
                <option value="ãƒ‘ãƒ“ãƒªã‚ªãƒ³">ãƒ‘ãƒ“ãƒªã‚ªãƒ³</option>
                <option value="ãã®ä»–" selected>ãã®ä»–</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="addTitle" class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
              <input type="text" id="addTitle" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="addDescription" class="form-label">å†…å®¹</label>
              <input type="text" id="addDescription" class="form-control" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button type="submit" class="btn btn-success">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- â˜… ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚«ãƒ†ã‚´ãƒªç·¨é›†ã‚‚è¿½åŠ ï¼‰ -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="editForm">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">ãƒ¡ãƒ¢ã‚’ç·¨é›†</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editId">
            <div class="mb-3">
              <label for="editCategory" class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
              <select id="editCategory" class="form-select" required>
                <option value="é£Ÿäº‹">é£Ÿäº‹</option>
                <option value="è¦³å…‰åœ°">è¦³å…‰åœ°</option>
                <option value="ãƒ‘ãƒ“ãƒªã‚ªãƒ³">ãƒ‘ãƒ“ãƒªã‚ªãƒ³</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editTitle" class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
              <input type="text" id="editTitle" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="editDescription" class="form-label">å†…å®¹</label>
              <input type="text" id="editDescription" class="form-control" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button type="submit" class="btn btn-success">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div><!-- /.container -->

</div>


<!-- Bootstrap JS ã¨ wheelzoom -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wheelzoom@4.0.1/wheelzoom.min.js"></script>

<script>
/* ---------- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ---------- */
const previewImage = document.getElementById('previewImage'),
      modalImage   = document.getElementById('modalImage'),
      bsImageModal = new bootstrap.Modal(document.getElementById('imageModal'));

document.getElementById('imageModal')
  .addEventListener('shown.bs.modal', () => wheelzoom(modalImage, {zoom:0.1, maxZoom:5}));
document.getElementById('imageModal')
  .addEventListener('hidden.bs.modal', () => { modalImage.dispatchEvent(new CustomEvent('wheelzoom.destroy')); modalImage.style.transform=''; modalImage.src=''; });

previewImage.addEventListener('click', () => { modalImage.src=previewImage.src; bsImageModal.show(); });

/* ---------- DOM å‚ç…§ ---------- */
const tbody      = document.querySelector('#noteTable tbody');

/* â˜… è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« DOM */
const addBtn     = document.getElementById('addBtn'),
      addForm    = document.getElementById('addForm'),
      addTitle   = document.getElementById('addTitle'),
      addDesc    = document.getElementById('addDescription'),
      addModal   = new bootstrap.Modal(document.getElementById('addModal'));

/* â˜… ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« DOM */
const editForm   = document.getElementById('editForm'),
      editId     = document.getElementById('editId'),
      editTitle  = document.getElementById('editTitle'),
      editDesc   = document.getElementById('editDescription'),
      editModal  = new bootstrap.Modal(document.getElementById('editModal'));

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ */
const filterGroup  = document.getElementById('filterGroup');
let   currentFilter = 'all';

/* ---------- API ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
async function api(path, method='GET', body=null) {
  const opt={method, headers:{'Content-Type':'application/json'}};
  if(body) opt.body=JSON.stringify(body);
  const res=await fetch(path,opt);
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

/* ---------- ãƒ†ãƒ¼ãƒ–ãƒ«æç”» ---------- */
let cacheNotes = [];                 // â†å–å¾—æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
const catIcons = {
  'é£Ÿäº‹'     : '<i class="bi bi-cup-hot me-1"></i>', // ğŸŸ¢
  'è¦³å…‰åœ°'   : '<i class="bi bi-suitcase me-1"></i>', // ğŸŸ 
  'ãƒ‘ãƒ“ãƒªã‚ªãƒ³': '<i class="bi bi-bank me-1"></i>',
  'ãã®ä»–'   : '<span class="cat-icon" title="ãã®ä»–">&#x1f7e3;</span>'  // ğŸŸ£
};

function render(){
  tbody.innerHTML='';
  const notes = (currentFilter==='all')
      ? cacheNotes
      : cacheNotes.filter(n => n.category === currentFilter);

  notes.forEach(n=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="text-center">${catIcons[n.category] || ''}</td>
      <td>${n.title}</td>
      <td>${n.description}</td>
      <td>${n.author}</td>
      <td>
        <button class="btn btn-sm btn-outline-secondary me-1"
                onclick="openEdit(${n.id},'${n.category}','${n.title.replace(/'/g,"&#39;")}','${n.description.replace(/'/g,"&#39;")}')">ç·¨é›†</button>
        <button class="btn btn-sm btn-outline-secondary" onclick="removeNote(${n.id})">å‰Šé™¤</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

/* ---------- åˆå›ãƒ­ãƒ¼ãƒ‰ ---------- */
async function refresh(){
  cacheNotes = await api('/api/notes');
  render();
}
window.addEventListener('DOMContentLoaded', refresh);

/* ---------- è¿½åŠ  ---------- */
addBtn.addEventListener('click', () => { addForm.reset(); addModal.show(); });
addForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const payload={category:addCategory.value, title:addTitle.value, description:addDesc.value};
  await api('/api/notes','POST',payload);
  addModal.hide();
  refresh();
});

/* ---------- ç·¨é›† ---------- */
function openEdit(id,cat,title,desc){
  editId.value=id;
  editCategory.value=cat;
  editTitle.value=title;
  editDesc.value=desc;
  editModal.show();
}
editForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const payload={category:editCategory.value, title:editTitle.value, description:editDesc.value};
  await api('/api/notes/'+editId.value,'PUT',payload);
  editModal.hide();
  refresh();
});

/* ---------- å‰Šé™¤ ---------- */
async function removeNote(id){
  if(confirm('å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')){
    await api('/api/notes/'+id,'DELETE');
    refresh();
  }
}

/* ---------- ãƒ•ã‚£ãƒ«ã‚¿ ---------- */
filterGroup.addEventListener('click', e=>{
  const btn=e.target.closest('button[data-cat]');
  if(!btn) return;
  [...filterGroup.children].forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentFilter = btn.dataset.cat;
  render();
});
</script>
</body>
</html>
